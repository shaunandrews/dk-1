---
description: Guide for developing @wordpress/components with Storybook and documentation
globs: ["repos/gutenberg/packages/components/**/*"]
---

# Developing @wordpress/components

This guide covers the patterns and conventions for developing components in `@wordpress/components`, including file structure, Storybook stories, documentation, and testing.

## Component File Structure

Each component lives in its own directory under `packages/components/src/`:

```
packages/components/src/my-component/
├── index.tsx           # Main component implementation
├── types.ts            # TypeScript type definitions
├── style.scss          # Component styles
├── README.md           # Documentation
├── stories/
│   └── index.story.tsx # Storybook stories
└── test/
    └── index.tsx       # Unit tests
```

## TypeScript Types (`types.ts`)

Define prop types with complete JSDoc comments. These comments power IDE tooltips and can be used for auto-generated documentation.

```typescript
/**
 * External dependencies
 */
import type { ReactNode } from 'react';

export type MyComponentProps = {
	/**
	 * Description of what this prop does. Include details about behavior
	 * and edge cases.
	 */
	label: ReactNode;
	/**
	 * Description with default value noted.
	 *
	 * @default 'start'
	 */
	position?: 'start' | 'end';
	/**
	 * Callback function description. Explain what triggers it and
	 * what the parameters represent.
	 */
	onChange: ( value: boolean ) => void;
};
```

### Key conventions:
- Use `ReactNode` for content that can be text, elements, or components
- Document `@default` values in JSDoc
- Use union types (`'start' | 'end'`) instead of generic strings for constrained values
- Prefer logical values (`'start' | 'end'`) over physical values (`'left' | 'right'`) for RTL support

## Storybook Stories (`stories/index.story.tsx`)

Stories provide interactive documentation and visual testing.

```typescript
/**
 * External dependencies
 */
import type { Meta, StoryFn } from '@storybook/react-vite';

/**
 * WordPress dependencies
 */
import { useState } from '@wordpress/element';

/**
 * Internal dependencies
 */
import MyComponent from '..';

const meta: Meta< typeof MyComponent > = {
	title: 'Components/Category/MyComponent',
	id: 'components-mycomponent',
	component: MyComponent,
	argTypes: {
		// Disable controls for managed state
		checked: { control: false },
		// Use text input for string props
		label: { control: { type: 'text' } },
		// Use radio for union types
		position: {
			control: { type: 'radio' },
			options: [ 'start', 'end' ],
		},
		// Capture callbacks as actions
		onChange: { action: 'onChange' },
	},
	parameters: {
		controls: { expanded: true },
		docs: { canvas: { sourceState: 'shown' } },
	},
};
export default meta;

// Template for stateful components
const Template: StoryFn< typeof MyComponent > = ( { onChange, ...props } ) => {
	const [ value, setValue ] = useState( false );
	return (
		<MyComponent
			{ ...props }
			checked={ value }
			onChange={ ( newValue ) => {
				setValue( newValue );
				onChange( newValue );
			} }
		/>
	);
};

// Default story
export const Default = Template.bind( {} );
Default.args = {
	label: 'My label',
};

// Variant stories
export const WithPosition = Template.bind( {} );
WithPosition.args = {
	...Default.args,
	position: 'end',
};
```

### Story naming conventions:
- `Default` - Basic usage with minimal props
- `With{Feature}` - Demonstrates a specific prop or feature
- `{State}` - Shows a specific state (e.g., `Disabled`, `Loading`)

### Storybook commands:
```bash
cd repos/gutenberg

# Start Storybook (includes dev build)
npm run storybook:dev

# Storybook runs at http://localhost:50240
```

## Documentation (`README.md`)

Follow the established pattern for form controls:

```markdown
# ComponentName

Brief description of what the component does.

![Screenshot or diagram](https://example.com/image.png)

## Design guidelines

### Usage

#### When to use this component

- Bullet points for use cases
- When to prefer this over alternatives

![](https://example.com/do-example.png)

**Do**
Description of correct usage.

![](https://example.com/dont-example.png)

**Don't**
Description of incorrect usage.

### Behavior

Describe how the component behaves when interacted with.

## Development guidelines

### Usage

\`\`\`jsx
import { useState } from 'react';
import { ComponentName } from '@wordpress/components';

const MyComponent = () => {
	const [ value, setValue ] = useState( false );

	return (
		<ComponentName
			label="Example"
			checked={ value }
			onChange={ setValue }
		/>
	);
};
\`\`\`

### Props

The component accepts the following props:

#### \`propName\`: \`PropType\`

Description of what the prop does.

- Required: Yes/No
- Default: \`value\` (if applicable)

## Related components

- Link to similar or related components with brief explanation
```

### Documentation checklist:
- [ ] Opening description
- [ ] Screenshot/diagram (if available)
- [ ] Design guidelines with Do/Don't examples
- [ ] Code example showing typical usage
- [ ] All props documented with types
- [ ] Related components section

## Unit Tests (`test/index.tsx`)

Use React Testing Library patterns:

```typescript
/**
 * External dependencies
 */
import { render, screen } from '@testing-library/react';

/**
 * Internal dependencies
 */
import MyComponent from '..';

describe( 'MyComponent', () => {
	it( 'should render with label', () => {
		render( <MyComponent label="Test" onChange={ () => {} } /> );
		expect( screen.getByText( 'Test' ) ).toBeInTheDocument();
	} );

	it( 'should call onChange when clicked', () => {
		const onChange = jest.fn();
		render( <MyComponent label="Test" onChange={ onChange } /> );
		
		screen.getByRole( 'checkbox' ).click();
		expect( onChange ).toHaveBeenCalledWith( true );
	} );

	describe( 'propName', () => {
		it( 'should handle default value', () => {
			// Test default behavior
		} );

		it( 'should handle custom value', () => {
			// Test with prop set
		} );
	} );
} );
```

### Test commands:
```bash
cd repos/gutenberg

# Run all unit tests
npm run test-unit

# Run tests for specific component
npm run test-unit -- --testPathPattern=toggle-control

# Run tests in watch mode
npm run test-unit -- --watch
```

## Styling (`style.scss`)

Use SCSS with Gutenberg's design tokens:

```scss
@use "@wordpress/base-styles/variables" as *;
@use "../other-component/style" as other;

.components-my-component {
	// Use grid units for spacing
	padding: $grid-unit-10;
	margin-block-end: $grid-unit-15;

	// Reference other component variables
	line-height: other.$some-height;

	// BEM-style modifiers
	&.is-active {
		// Active state styles
	}

	&__label {
		// Child element styles
	}
}
```

### CSS class naming:
- Root: `.components-{component-name}`
- Children: `.components-{component-name}__{element}`
- Modifiers: `.is-{state}` (e.g., `.is-disabled`, `.is-active`)

## Adding a New Prop

When adding a new prop to an existing component:

1. **Update `types.ts`** - Add the prop with JSDoc comment and `@default` if applicable
2. **Update `index.tsx`** - Implement the prop with default value in destructuring
3. **Update `style.scss`** - Add any necessary styles
4. **Update `stories/index.story.tsx`** - Add argType and new stories demonstrating the prop
5. **Update `README.md`** - Document in both Design guidelines and Props sections
6. **Update `test/index.tsx`** - Add tests for default and custom values
7. **Rebuild types** - Run `npx tsc --build packages/components`

## Quick Reference

| Task | Command |
|------|---------|
| Start Storybook | `npm run storybook:dev` |
| Run tests | `npm run test-unit -- --testPathPattern={component}` |
| Rebuild types | `npx tsc --build packages/components` |
| Lint | `npm run lint` |
| Type check | `npx tsc --build` |
